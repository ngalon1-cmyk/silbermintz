<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×××©×§ ×× ×”×œ - ××¢×§×‘ ×”×™×¢×“×¨×•×™×•×ª</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700&family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2D5BFF;
            --primary-dark: #1E40AF;
            --secondary: #00C9A7;
            --bg-main: #F8FAFC;
            --bg-card: #FFFFFF;
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --border: #E2E8F0;
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
            --vacation: #8B5CF6;
            --sick: #EF4444;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Assistant', sans-serif;
            background: var(--bg-main);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 16px;
            padding: 30px;
            color: white;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
        }

        .header h1 {
            font-family: 'Heebo', sans-serif;
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .nav-links {
            margin-bottom: 20px;
        }

        .nav-links a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .nav-links a:hover {
            color: var(--primary-dark);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--primary);
        }

        .stat-card.vacation {
            border-left-color: var(--vacation);
        }

        .stat-card.sick {
            border-left-color: var(--sick);
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .stat-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'Heebo', sans-serif;
            color: var(--text-primary);
        }

        .filters {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filters select, .filters input {
            padding: 10px 14px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: 'Assistant', sans-serif;
            font-size: 0.95rem;
            background: var(--bg-main);
        }

        .filters select:focus, .filters input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .filters button {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filters button:hover {
            background: var(--primary-dark);
        }

        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            margin-bottom: 30px;
        }

        .table-header {
            background: var(--bg-main);
            padding: 20px;
            border-bottom: 2px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h2 {
            font-family: 'Heebo', sans-serif;
            font-size: 1.3rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            text-align: right;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg-main);
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            color: var(--text-primary);
        }

        tbody tr:hover {
            background: var(--bg-main);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge.vacation-full {
            background: #EDE9FE;
            color: var(--vacation);
        }

        .badge.sick {
            background: #FEE2E2;
            color: var(--sick);
        }

        .badge.vacation-half {
            background: #DBEAFE;
            color: #2563EB;
        }

        .summary-table {
            margin-top: 30px;
        }

        .summary-table th {
            background: var(--primary);
            color: white;
        }

        .export-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .export-btn:hover {
            opacity: 0.9;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .table-container {
                overflow-x: auto;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .filters select, .filters input, .filters button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-links">
            <a href="employee-time-off.html">â† ×—×–×¨×” ×œ×¢×“×›×•×Ÿ ×”×™×¢×“×¨×•×ª</a>
        </div>

        <div class="header">
            <h1>ğŸ” ×××©×§ ×× ×”×œ - ××¢×§×‘ ×”×™×¢×“×¨×•×™×•×ª</h1>
            <p>×¦×¤×™×™×” ×‘×›×œ ×”×”×™×¢×“×¨×•×™×•×ª ×•×¦×‘×™×¨×ª ×™××™ ×—×•×¤×© ×•××—×œ×” ×©×œ ×”×¢×•×‘×“×™×</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>×¡×”"×› ×”×™×¢×“×¨×•×™×•×ª ×”×—×•×“×©</h3>
                <div class="value" id="totalAbsences">0</div>
            </div>
            <div class="stat-card vacation">
                <h3>×™××™ ×—×•×¤×© ×”×—×•×“×©</h3>
                <div class="value" id="totalVacation">0</div>
            </div>
            <div class="stat-card sick">
                <h3>×™××™ ××—×œ×” ×”×—×•×“×©</h3>
                <div class="value" id="totalSick">0</div>
            </div>
        </div>

        <div class="filters">
            <select id="filterEmployee">
                <option value="">×›×œ ×”×¢×•×‘×“×™×</option>
            </select>
            <select id="filterType">
                <option value="">×›×œ ×¡×•×’×™ ×”×”×™×¢×“×¨×•×ª</option>
                <option value="vacation-full">×™×•× ×—×•×¤×©</option>
                <option value="sick">×™×•× ××—×œ×”</option>
                <option value="vacation-half">×—×¦×™ ×™×•× ×—×•×¤×©</option>
            </select>
            <input type="month" id="filterMonth" />
            <button onclick="applyFilters()">×¡× ×Ÿ</button>
            <button onclick="clearFilters()" style="background: var(--text-secondary);">× ×§×”</button>
            <button class="export-btn" onclick="exportToExcel()">ğŸ“Š ×™×™×¦× ×œ××§×¡×œ</button>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h2>×”×™×¡×˜×•×¨×™×™×ª ×”×™×¢×“×¨×•×™×•×ª</h2>
            </div>
            <table id="absencesTable">
                <thead>
                    <tr>
                        <th>×ª××¨×™×š ×¨×™×©×•×</th>
                        <th>×©× ×¢×•×‘×“</th>
                        <th>×¡×•×’</th>
                        <th>××ª××¨×™×š</th>
                        <th>×¢×“ ×ª××¨×™×š</th>
                        <th>×™××™×</th>
                        <th>×”×¢×¨×•×ª</th>
                    </tr>
                </thead>
                <tbody id="absencesBody">
                </tbody>
            </table>
        </div>

        <div class="table-container summary-table">
            <div class="table-header">
                <h2>×¡×™×›×•× ×œ×¤×™ ×¢×•×‘×“ - ×¦×‘×™×¨×” ×©× ×ª×™×ª</h2>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>×©× ×¢×•×‘×“</th>
                        <th>×™××™ ×—×•×¤×©</th>
                        <th>×—×¦××™ ×™××™ ×—×•×¤×©</th>
                        <th>×™××™ ××—×œ×”</th>
                        <th>×¡×”"×› ×™××™ ×”×™×¢×“×¨×•×ª</th>
                    </tr>
                </thead>
                <tbody id="summaryBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const employees = [
            { name: '×’×¨×’×•×¨×™', email: 'gregory@silbermintz.co.il' },
            { name: '×©×¨×”', email: 'sara@silbermintz.co.il' },
            { name: '×©×™', email: 'shay@silbermintz.co.il' },
            { name: '×©××•××œ', email: 'shmuel@silbermintz.co.il' },
            { name: '×¦×‘×™×§×”', email: 'zvika@silbermintz.co.il' },
            { name: '××‘×™×©×™ ×œ×¨× ×¨', email: 'avishay@silbermintz.co.il' },
            { name: '××•×“×œ×™×” ×¢× ×ª×¨', email: 'odelya@silbermintz.co.il' },
            { name: '××œ×›×¡ ×’×¨×™× ×‘×¨×’', email: 'alex@silbermintz.co.il' },
            { name: '×’×•×“×¨ ×’×¨×“', email: 'goder@silbermintz.co.il' },
            { name: '×“×•×“ ×–×™×œ×‘×¨××™× ×¥', email: 'dudi@silbermintz.co.il' },
            { name: '×–××‘ ××™×œ×•×š', email: 'zeev@silbermintz.co.il' },
            { name: '×™×¢×§×‘ ×“×•×™×“', email: 'Jacob@silbermintz.co.il' },
            { name: '×œ×™××ª ×¤×•×¨×–×¨', email: 'Iat@silbermintz.co.il' },
            { name: '××•×¨×Ÿ ×’×œ××•×¨', email: 'moran@silbermintz.co.il' },
            { name: '× ×•×¢× ×œ×‘×¨×•×Ÿ ××™××•×Ÿ', email: 'noam@silbermintz.co.il' },
            { name: '× ×™×¦×Ÿ ×›×œ××•×Ÿ', email: 'nitsan@silbermintz.co.il' },
            { name: '×¢×“×™×¨ ×§×™×¨×™××ª ×’×ª', email: 't@silbermintz.co.il' },
            { name: '×¢× ×ª ×××•×¨', email: 'anatm@silbermintz.co.il' },
            { name: '×¨×•×™×ª ×›×”×Ÿ', email: 'ravit@silbermintz.co.il' },
            { name: '×©××•××œ×™×§', email: 'Shmulik@silbermintz.co.il' },
            { name: '×©×¨×’×', email: 'shraga@silbermintz.co.il' }
        ];

        const typeMap = {
            'vacation-full': '×™×•× ×—×•×¤×©',
            'sick': '×™×•× ××—×œ×”',
            'vacation-half': '×—×¦×™ ×™×•× ×—×•×¤×©'
        };

        let allRecords = [];

        // Populate employee filter
        const filterEmployee = document.getElementById('filterEmployee');
        employees.forEach(emp => {
            const option = document.createElement('option');
            option.value = emp.name;
            option.textContent = emp.name;
            filterEmployee.appendChild(option);
        });

        // Set default month to current
        const now = new Date();
        document.getElementById('filterMonth').value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;

        function loadRecords() {
            allRecords = JSON.parse(localStorage.getItem('absenceRecords') || '[]');
            displayRecords(allRecords);
            updateStats(allRecords);
            updateSummary(allRecords);
        }

        function displayRecords(records) {
            const tbody = document.getElementById('absencesBody');
            
            if (records.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div>ğŸ“­</div>
                            <div>××™×Ÿ ×”×™×¢×“×¨×•×™×•×ª ×¨×©×•××•×ª</div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = records.map(record => `
                <tr>
                    <td>${formatDateTime(record.timestamp)}</td>
                    <td><strong>${record.employeeName}</strong></td>
                    <td><span class="badge ${record.requestType}">${typeMap[record.requestType]}</span></td>
                    <td>${formatDate(record.startDate)}</td>
                    <td>${formatDate(record.endDate)}</td>
                    <td><strong>${record.days}</strong></td>
                    <td>${record.reason || '-'}</td>
                </tr>
            `).join('');
        }

        function updateStats(records) {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const thisMonthRecords = records.filter(r => {
                const date = new Date(r.startDate);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });

            document.getElementById('totalAbsences').textContent = thisMonthRecords.length;
            
            const vacationDays = thisMonthRecords
                .filter(r => r.requestType === 'vacation-full' || r.requestType === 'vacation-half')
                .reduce((sum, r) => sum + (r.requestType === 'vacation-half' ? 0.5 : r.days), 0);
            
            const sickDays = thisMonthRecords
                .filter(r => r.requestType === 'sick')
                .reduce((sum, r) => sum + r.days, 0);

            document.getElementById('totalVacation').textContent = vacationDays;
            document.getElementById('totalSick').textContent = sickDays;
        }

        function updateSummary(records) {
            const summary = {};
            
            employees.forEach(emp => {
                summary[emp.name] = {
                    vacationFull: 0,
                    vacationHalf: 0,
                    sick: 0
                };
            });

            records.forEach(record => {
                if (summary[record.employeeName]) {
                    if (record.requestType === 'vacation-full') {
                        summary[record.employeeName].vacationFull += record.days;
                    } else if (record.requestType === 'vacation-half') {
                        summary[record.employeeName].vacationHalf += record.days;
                    } else if (record.requestType === 'sick') {
                        summary[record.employeeName].sick += record.days;
                    }
                }
            });

            const summaryBody = document.getElementById('summaryBody');
            summaryBody.innerHTML = Object.entries(summary).map(([name, data]) => {
                const total = data.vacationFull + (data.vacationHalf * 0.5) + data.sick;
                return `
                    <tr>
                        <td><strong>${name}</strong></td>
                        <td>${data.vacationFull}</td>
                        <td>${data.vacationHalf}</td>
                        <td>${data.sick}</td>
                        <td><strong>${total}</strong></td>
                    </tr>
                `;
            }).join('');
        }

        function applyFilters() {
            const empFilter = document.getElementById('filterEmployee').value;
            const typeFilter = document.getElementById('filterType').value;
            const monthFilter = document.getElementById('filterMonth').value;

            let filtered = allRecords;

            if (empFilter) {
                filtered = filtered.filter(r => r.employeeName === empFilter);
            }

            if (typeFilter) {
                filtered = filtered.filter(r => r.requestType === typeFilter);
            }

            if (monthFilter) {
                const [year, month] = monthFilter.split('-');
                filtered = filtered.filter(r => {
                    const date = new Date(r.startDate);
                    return date.getFullYear() === parseInt(year) && 
                           date.getMonth() === parseInt(month) - 1;
                });
            }

            displayRecords(filtered);
        }

        function clearFilters() {
            document.getElementById('filterEmployee').value = '';
            document.getElementById('filterType').value = '';
            const now = new Date();
            document.getElementById('filterMonth').value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
            displayRecords(allRecords);
        }

        function exportToExcel() {
            const summary = {};
            employees.forEach(emp => {
                summary[emp.name] = { vacationFull: 0, vacationHalf: 0, sick: 0 };
            });

            allRecords.forEach(record => {
                if (summary[record.employeeName]) {
                    if (record.requestType === 'vacation-full') {
                        summary[record.employeeName].vacationFull += record.days;
                    } else if (record.requestType === 'vacation-half') {
                        summary[record.employeeName].vacationHalf += record.days;
                    } else if (record.requestType === 'sick') {
                        summary[record.employeeName].sick += record.days;
                    }
                }
            });

            let csv = '×©× ×¢×•×‘×“,×™××™ ×—×•×¤×©,×—×¦××™ ×™××™ ×—×•×¤×©,×™××™ ××—×œ×”,×¡×”"×›\n';
            Object.entries(summary).forEach(([name, data]) => {
                const total = data.vacationFull + (data.vacationHalf * 0.5) + data.sick;
                csv += `${name},${data.vacationFull},${data.vacationHalf},${data.sick},${total}\n`;
            });

            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `absence_summary_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('he-IL', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit' 
            });
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('he-IL', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Load on page load
        loadRecords();

        // Refresh every 30 seconds to catch new entries
        setInterval(loadRecords, 30000);
    </script>
</body>
</html>
